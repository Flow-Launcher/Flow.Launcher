<Window x:Class="Flow.Launcher.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:flowlauncher="clr-namespace:Flow.Launcher"
        xmlns:vm="clr-namespace:Flow.Launcher.ViewModel"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:converters="clr-namespace:Flow.Launcher.Converters"
        xmlns:svgc="http://sharpvectors.codeplex.com/svgc/"
        mc:Ignorable="d"
        Title="Flow Launcher"
        Topmost="True"
        SizeToContent="Height"
        ResizeMode="NoResize"
        WindowStyle="None"
        WindowStartupLocation="Manual"
        AllowDrop="True"
        ShowInTaskbar="False"
        Style="{DynamicResource WindowStyle}"
        Icon="Images/app.png"
        AllowsTransparency="True"
        Background="Transparent"
        Loaded="OnLoaded"
        Initialized="OnInitialized"
        Closing="OnClosing"
        LocationChanged="OnLocationChanged"
        Deactivated="OnDeactivated"
        PreviewKeyDown="OnKeyDown"
        MinWidth="{Binding MainWindowWidth, Mode=OneWay}"
        MaxWidth="{Binding MainWindowWidth, Mode=OneWay}"
        Visibility="{Binding MainWindowVisibility, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
        d:DataContext="{d:DesignInstance vm:MainViewModel}">
    <Window.Resources>
        <converters:QuerySuggestionBoxConverter x:Key="QuerySuggestionBoxConverter"/>
        <converters:BorderClipConverter x:Key="BorderClipConverter"/>
        <Style  TargetType="{x:Type ListBoxItem}">
            <Style.Triggers>
                <Trigger Property="ItemsControl.AlternationIndex" Value="0">
                    <Setter Property="Background" Value="Transparent"></Setter>
                </Trigger>
                <Trigger Property="ItemsControl.AlternationIndex" Value="1">
                    <Setter Property="Background" Value="#10828282"></Setter>
                </Trigger>
            </Style.Triggers>
        </Style>
        <XmlDataProvider x:Key="InventoryData" XPath="Inventory/Books">
            <x:XData>
                <Inventory xmlns="" version="1.0" encoding="UTF-8">
                    <Books>
                        <Book ISBN="0-7356-1370-2" Stock="in" Number="8">
                            <Title>F1</Title>
                            <Summary>Toggle Help Window</Summary>
                        </Book>
                        <Book ISBN="0-7356-0562-9" Stock="in" Number="9">
                            <Title>F2</Title>
                            <Summary>Preview Toggle</Summary>
                        </Book>
                        <Book ISBN="0-7356-0562-9" Stock="in" Number="9">
                            <Title>Ctrl+Enter</Title>
                            <Summary>Open Contaning Folder</Summary>
                        </Book>
                        <Book ISBN="0-7356-1377-X" Stock="in" Number="9">
                            <Title>Ctrl+Shift+Enter</Title>
                            <Summary>Run as Admin</Summary>
                        </Book>
                        <Book ISBN="0-7356-1377-X" Stock="in" Number="9">
                            <Title>Ctrl+C</Title>
                            <Summary>Copy File Path</Summary>
                        </Book>
                        <Book ISBN="0-7356-1377-X" Stock="in" Number="9">
                            <Title>Shift+Enter</Title>
                            <Summary>Open Context Menu</Summary>
                        </Book>
                        <Book ISBN="0-7356-1377-X" Stock="in" Number="9">
                            <Title>Ctrl+Backspace</Title>
                            <Summary>Clear Query</Summary>
                        </Book>
                        <Book ISBN="0-7356-1377-X" Stock="in" Number="9">
                            <Title>Ctrl+H</Title>
                            <Summary>Clear Query</Summary>
                        </Book>
                        <Book ISBN="0-7356-1377-X" Stock="in" Number="9">
                            <Title>ESC</Title>
                            <Summary>Back to Result in Context Menu</Summary>
                        </Book>
                    </Books>
                </Inventory>
            </x:XData>
        </XmlDataProvider>
    </Window.Resources>
    <Window.InputBindings>
        <KeyBinding Key="Escape" Command="{Binding EscCommand}"></KeyBinding>
        <!--<KeyBinding Key="F1" Command="{Binding StartHelpCommand}"></KeyBinding>-->
        <KeyBinding Key="F5" Command="{Binding ReloadPluginDataCommand}"></KeyBinding>
        <KeyBinding Key="Tab" Command="{Binding SelectNextItemCommand}"></KeyBinding>
        <KeyBinding Key="Tab" Modifiers="Shift" Command="{Binding SelectPrevItemCommand}"></KeyBinding>
        <KeyBinding Key="N" Modifiers="Ctrl" Command="{Binding SelectNextItemCommand}"></KeyBinding>
        <KeyBinding Key="J" Modifiers="Ctrl" Command="{Binding SelectNextItemCommand}"></KeyBinding>
        <KeyBinding Key="D" Modifiers="Ctrl" Command="{Binding SelectNextPageCommand}"></KeyBinding>
        <KeyBinding Key="P" Modifiers="Ctrl" Command="{Binding SelectPrevItemCommand}"></KeyBinding>
        <KeyBinding Key="K" Modifiers="Ctrl" Command="{Binding SelectPrevItemCommand}"></KeyBinding>
        <KeyBinding Key="U" Modifiers="Ctrl" Command="{Binding SelectPrevPageCommand}"></KeyBinding>
        <KeyBinding Key="Home" Modifiers="Alt" Command="{Binding SelectFirstResultCommand}"></KeyBinding>
        <KeyBinding Key="O" Modifiers="Ctrl" Command="{Binding LoadContextMenuCommand}"></KeyBinding>
        <KeyBinding Key="Right" Command="{Binding LoadContextMenuCommand}"></KeyBinding>
        <KeyBinding Key="Left" Command="{Binding EscCommand}"></KeyBinding>
        <KeyBinding Key="H" Modifiers="Ctrl" Command="{Binding LoadHistoryCommand}"></KeyBinding>
        <KeyBinding Key="Enter" Modifiers="Ctrl+Shift" Command="{Binding OpenResultCommand}"></KeyBinding>
        <KeyBinding Key="Enter" Modifiers="Shift" Command="{Binding LoadContextMenuCommand}"></KeyBinding>
        <KeyBinding Key="Enter" Command="{Binding OpenResultCommand}"></KeyBinding>
        <KeyBinding Key="Enter" Modifiers="Ctrl" Command="{Binding OpenResultCommand}"></KeyBinding>
        <KeyBinding Key="Enter" Modifiers="Alt" Command="{Binding OpenResultCommand}"></KeyBinding>
        <KeyBinding Key="D1" Modifiers="{Binding OpenResultCommandModifiers}" Command="{Binding OpenResultCommand}" CommandParameter="0"></KeyBinding>
        <KeyBinding Key="D2" Modifiers="{Binding OpenResultCommandModifiers}" Command="{Binding OpenResultCommand}" CommandParameter="1"></KeyBinding>
        <KeyBinding Key="D3" Modifiers="{Binding OpenResultCommandModifiers}" Command="{Binding OpenResultCommand}" CommandParameter="2"></KeyBinding>
        <KeyBinding Key="D4" Modifiers="{Binding OpenResultCommandModifiers}" Command="{Binding OpenResultCommand}" CommandParameter="3"></KeyBinding>
        <KeyBinding Key="D5" Modifiers="{Binding OpenResultCommandModifiers}" Command="{Binding OpenResultCommand}" CommandParameter="4"></KeyBinding>
        <KeyBinding Key="D6" Modifiers="{Binding OpenResultCommandModifiers}" Command="{Binding OpenResultCommand}" CommandParameter="5"></KeyBinding>
        <KeyBinding Key="D7" Modifiers="{Binding OpenResultCommandModifiers}" Command="{Binding OpenResultCommand}" CommandParameter="6"></KeyBinding>
        <KeyBinding Key="D8" Modifiers="{Binding OpenResultCommandModifiers}" Command="{Binding OpenResultCommand}" CommandParameter="7"></KeyBinding>
        <KeyBinding Key="D9" Modifiers="{Binding OpenResultCommandModifiers}" Command="{Binding OpenResultCommand}" CommandParameter="8"></KeyBinding>
    </Window.InputBindings>
    <Grid>
        <Border Style="{DynamicResource WindowBorderStyle}" MouseDown="OnMouseDown">
            <StackPanel Orientation="Vertical">
                <Grid>
                    <TextBox x:Name="QueryTextSuggestionBox"
                         Style="{DynamicResource QuerySuggestionBoxStyle}"
                         IsEnabled="False">
                        <TextBox.Text>
                            <MultiBinding Converter="{StaticResource QuerySuggestionBoxConverter}">
                                <Binding ElementName="QueryTextBox" Path="Text"/>
                                <Binding ElementName="ResultListBox" Path="SelectedItem"/>
                            </MultiBinding>
                        </TextBox.Text>
                    </TextBox>
                    <TextBox x:Name="QueryTextBox"
                    Style="{DynamicResource QueryBoxStyle}"
                     Text="{Binding QueryText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                     PreviewDragOver="OnPreviewDragOver"
                     AllowDrop="True"
                     Visibility="Visible"
                    Background="Transparent">
                        <TextBox.ContextMenu>
                            <ContextMenu>
                                <MenuItem Command="ApplicationCommands.Cut"/>
                                <MenuItem Command="ApplicationCommands.Copy"/>
                                <MenuItem Command="ApplicationCommands.Paste"/>
                                <Separator />
                                <MenuItem Header="{DynamicResource flowlauncher_settings}"  Click="OnContextMenusForSettingsClick" />
                                <MenuItem Command="{Binding EscCommand}" Header="Close"/>
                            </ContextMenu>
                        </TextBox.ContextMenu>
                    </TextBox>
                    <Canvas Style="{DynamicResource SearchIconPosition}">
                        <TextBlock Style="{DynamicResource StartHereMessage}" TextAlignment="Right" Canvas.Right="55" IsHitTestVisible="false" FontSize="14" Canvas.Top="6">Press F1 for Help</TextBlock>
                        <Path Data="{DynamicResource SearchIconImg}" Style="{DynamicResource SearchIconStyle}" Margin="0"  Stretch="Fill"/>
                    </Canvas>
                </Grid>

                <Grid ClipToBounds="True">
                    <ContentControl>
                        <ContentControl.Style>
                            <Style TargetType="ContentControl">
                                <Setter Property="Visibility" Value="Collapsed" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding ElementName=ResultListBox, Path=Visibility}" Value="Visible">
                                        <Setter Property="Visibility" Value="Visible" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding ElementName=ContextMenu, Path=Visibility}" Value="Visible">
                                        <Setter Property="Visibility" Value="Visible" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding ElementName=History, Path=Visibility}" Value="Visible">
                                        <Setter Property="Visibility" Value="Visible" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </ContentControl.Style>
                        <Rectangle Width="Auto" HorizontalAlignment="Stretch" Style="{DynamicResource SeparatorStyle}"/>
                    </ContentControl>
                    <Line x:Name="ProgressBar" HorizontalAlignment="Right"
                  Style="{DynamicResource PendingLineStyle}" Visibility="{Binding ProgressBarVisibility, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                  Y1="0" Y2="0" X1="-150" X2="-50" Height="2" Width="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Grid}},Path=ActualWidth}" StrokeThickness="1">
                    </Line>
                </Grid>

                <Border Style="{DynamicResource WindowRadius}">
                    <Border.Clip>
                        <MultiBinding Converter="{StaticResource BorderClipConverter}">
                            <Binding Path="ActualWidth" RelativeSource="{RelativeSource Self}"/>
                            <Binding Path="ActualHeight" RelativeSource="{RelativeSource Self}"/>
                            <Binding Path="CornerRadius" RelativeSource="{RelativeSource Self}"/>
                        </MultiBinding>
                    </Border.Clip>
                    <ContentControl>
                        <flowlauncher:ResultListBox x:Name="ResultListBox" DataContext="{Binding Results}" PreviewMouseDown="OnPreviewMouseButtonDown" />
                    </ContentControl>
                </Border>
                <Border Style="{DynamicResource WindowRadius}">
                    <Border.Clip>
                        <MultiBinding Converter="{StaticResource BorderClipConverter}">
                            <Binding Path="ActualWidth" RelativeSource="{RelativeSource Self}"/>
                            <Binding Path="ActualHeight" RelativeSource="{RelativeSource Self}"/>
                            <Binding Path="CornerRadius" RelativeSource="{RelativeSource Self}"/>
                        </MultiBinding>
                    </Border.Clip>
                     <ContentControl>
                        <flowlauncher:ResultListBox DataContext="{Binding ContextMenu}" PreviewMouseDown="OnPreviewMouseButtonDown" x:Name="ContextMenu"/>
                      </ContentControl>
                </Border>
                <Border Style="{DynamicResource WindowRadius}">
                <Border.Clip>
                        <MultiBinding Converter="{StaticResource BorderClipConverter}">
                            <Binding Path="ActualWidth" RelativeSource="{RelativeSource Self}"/>
                            <Binding Path="ActualHeight" RelativeSource="{RelativeSource Self}"/>
                            <Binding Path="CornerRadius" RelativeSource="{RelativeSource Self}"/>
                        </MultiBinding>
                </Border.Clip>
                        <ContentControl>
                        <flowlauncher:ResultListBox DataContext="{Binding History}" PreviewMouseDown="OnPreviewMouseButtonDown" x:Name="History"/>
                         </ContentControl>
                </Border>

                <Popup VerticalAlignment="Center" StaysOpen="False" x:Name="Starter" Style="{DynamicResource StarterStyle}" Margin="0 0 0 0" Placement="Right"  HorizontalOffset="6" VerticalOffset="0" AllowsTransparency="True">
                    <Border Style="{DynamicResource WindowBorderStyle}">
                        <StackPanel>
                        <DockPanel HorizontalAlignment="Stretch" LastChildFill="True" Margin="0 0 0 0">
                                <ListBox AlternationCount="2" Focusable="False" Padding="0 0 0 0" DockPanel.Dock="Right" Background="Transparent">
                                <ListBox.ItemsSource>
                                    <Binding Source="{StaticResource InventoryData}" XPath="*[@Stock='out'] | *[@Number>=8 or @Number=3]"/>
                                </ListBox.ItemsSource>
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Border Padding="14 8 4 8">
                                            <DockPanel LastChildFill="True">
                                                    <TextBlock FontSize="13" Style="{DynamicResource ItemTitleStyle}" TextAlignment="Left" FontWeight="SemiBold" Margin="0 0 12 0" DockPanel.Dock="Left">
                                                    <TextBlock.Text>
                                                        <Binding XPath="Title"/>
                                                    </TextBlock.Text>
                                                </TextBlock>
                                                    <TextBlock FontSize="13" Style="{DynamicResource ItemSubTitleStyle}" Margin="0 0 12 0">
                                                        <TextBlock.Text>
                                                            <Binding XPath="Summary"/>
                                                        </TextBlock.Text>
                                                    </TextBlock>
                                                </DockPanel>
                                        </Border>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                            </ListBox>
                        </DockPanel>
                    </StackPanel>
                    </Border>
                </Popup>

                <Border VerticalAlignment="Center" x:Name="TipBox" Style="{DynamicResource TipBoxStyle}" Margin="0 10 0 0" Padding="0 0 0 0">
                    <Border.Clip>
                        <MultiBinding Converter="{StaticResource BorderClipConverter}">
                            <Binding Path="ActualWidth" RelativeSource="{RelativeSource Self}"/>
                            <Binding Path="ActualHeight" RelativeSource="{RelativeSource Self}"/>
                            <Binding Path="CornerRadius" RelativeSource="{RelativeSource Self}"/>
                        </MultiBinding>
                    </Border.Clip>
                    <StackPanel>
                        <Rectangle Width="Auto" HorizontalAlignment="Stretch" Style="{DynamicResource SeparatorStyle}"/>
                        <TextBlock VerticalAlignment="Center" Style="{DynamicResource ItemHotkeyStyle}" LineHeight="15" Margin="0 0 0 8" TextWrapping="WrapWithOverflow" FontSize="11" HorizontalAlignment="Center" TextAlignment="Center" x:Name="TipText1"></TextBlock>
                    </StackPanel>
                </Border>
                
            </StackPanel>
        </Border>
    </Grid>
</Window>
